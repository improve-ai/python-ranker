[tox]
envlist = py3

ignored_dir_01=alter_py

pkg_dir=improveai
[testenv:py3]

setenv =
    DECISION_MODEL_PREDICTORS_DIR = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/models

    ; DecisionModel test
    DECISION_MODEL_TEST_CASES_DIRECTORY = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/data/test/decision_model
    DECISION_MODEL_TEST_LOAD_MODEL_FS_NATIVE_JSON = load_model_sync_native_fs.json
    DECISION_MODEL_TEST_LOAD_MODEL_FS_NATIVE_NO_MODEL_JSON = load_model_sync_native_fs_no_model.json
    DECISION_MODEL_TEST_LOAD_MODEL_URL_NO_MODEL_JSON  = load_model_sync_url_no_model.json
    DECISION_MODEL_TEST__SCORE_NATIVE_NO_MODEL_JSON = _score_native_no_model.json
    DECISION_MODEL_TEST__SCORE_NATIVE_JSON = _score_native.json
    DECISION_MODEL_TEST_SCORE_NATIVE_NO_MODEL_JSON = score_native_no_model.json
    DECISION_MODEL_TEST_SCORE_NATIVE_JSON = score_native.json
    DECISION_MODEL_TEST_RANK_NATIVE_NO_MODEL_JSON = ranked_native_no_model.json
    DECISION_MODEL_TEST_RANK_NATIVE_JSON = ranked_native.json
    DECISION_MODEL_TEST_TOP_SCORING_VARIANT_NATIVE_NO_MODEL_JSON = top_scoring_variant_native_no_model.json
    DECISION_MODEL_TEST_TOP_SCORING_VARIANT_NATIVE_JSON = top_scoring_variant_native.json
    DECISION_MODEL_TEST_GENERATE_DESCENDING_GAUSSIANS_JSON = generate_descending_gaussians.json
    DECISION_MODEL_TEST_CHOOSE_FROM_JSON = choose_from.json
    DECISION_MODEL_TEST_GIVEN_JSON = givens.json
    DECISION_MODEL_TEST_MODEL_NAME_SET_TO_NONE_JSON = model_name_set_to_none.json
    DECISION_MODEL_TEST_MODEL_NAME_SET_TO_NOT_NONE_JSON = model_name_set_to_not_none.json
    DECISION_MODEL_TEST_WHICH_JSON = which_native.json
    DECISION_MODEL_TEST_WHICH_NO_MODEL_JSON = which_native_no_model.json
    DECISION_MODEL_TEST_CHOOSE_FIRST_VALID_VARIANTS_JSON = choose_first_valid_variants.json
    DECISION_MODEL_TEST_FIRST_VALID_VARIANTS_JSON = first_valid_variants.json
    DECISION_MODEL_TEST_CHOOSE_RANDOM_VALID_VARIANTS_JSON = choose_random_valid_variants.json
    DECISION_MODEL_TEST_RANDOM_VALID_VARIANTS_JSON = random_valid_variants.json

    ; Decision test
    DUMMY_MODEL_PATH = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/models/dummy_v6.xgb
    DECISION_TEST_SUITE_JSONS_DIR = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/data/test/decision
    DECISION_TEST_CONSISTENCY_SEED = 10
    DECISION_TEST_GET_01_JSON = get_01.json
    DECISION_TEST_GET_02_JSON = get_02.json
    DECISION_TEST_GET_ZERO_LENGTH_VARIANTS_JSON = get_zero_length_variants.json
    DECISION_TEST_PEEK_VALID_VARIANTS_NO_GIVENS_JSON = peek_valid_variants_no_givens.json
    DECISION_TEST_PEEK_VALID_VARIANTS_NO_GIVENS_NO_MODEL_JSON = peek_valid_variants_no_givens_no_model.json
    DECISION_TEST_PEEK_VALID_VARIANTS_VALID_GIVENS_JSON = peek_valid_variants_valid_givens.json
    DECISION_TEST_PEEK_VALID_VARIANTS_VALID_GIVENS_NO_MODEL_JSON = peek_valid_variants_valid_givens_no_model.json
    DECISION_TEST_PEEK_ALREADY_CHOSEN_JSON = peek_already_chosen.json

    ; DecisionTracker
    DECISION_TRACKER_SHOULD_TRACK_RUNNERS_UP_VARIANTS_COUNT = 100
    DECISION_TRACKER_MAX_RUNNERS_UP = 10
    DECISION_TRACKER_TRACKS_SEED = 9
    DECISION_TRACKER_NOT_TRACKS_SEED = 1
    DECISION_TRACKER_SAMPLE_SEED = 2
    DECISION_TRACKER_FIRST_SAMPLE_IDENTICAL_WITH_VARIANT_SEED = 3
    DECISION_TRACKER_SAMPLE_NOT_TRACKS = 40
    DECISION_TRACKER_SAMPLE_TRACKS = 51
    DECISION_TRACKER_TEST_URL = http://test.v6.api/track
    DECISION_TRACKER_TEST_API_KEY = ''

    ; feature encoder test params
    FEATURE_ENCODER_MODEL_SEED = 1
    FEATURE_ENCODER_NOISE_SEED = 6
    FEATURE_ENCODER_CONTEXT_TYPEERROR_MSG = Only dict type is supported for context encoding
    CYTHON_FEATURE_ENCODER_CONTEXT_TYPEERROR_MSG = Argument 'givens' has incorrect type
    FEATURE_ENCODER_TEST_SUITE_JSONS_DIR = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/data/test/feature_encoder/test_suite
    FEATURE_ENCODER_TEST_PYTHON_SPECIFIC_JSONS_DIR = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/data/test/feature_encoder/python_specific
    FEATURE_ENCODER_TEST_BIG_FLOAT_JSON = big_float.json
    FEATURE_ENCODER_TEST_SMALL_FLOAT_JSON = small_float.json
    FEATURE_ENCODER_TEST_BIG_INT_NEGATIVE_JSON = big_int_negative.json
    FEATURE_ENCODER_TEST_BIG_INT_POSITIVE_JSON = big_int_positive.json
    FEATURE_ENCODER_TEST_BOOL_FALSE_JSON = bool_false.json
    FEATURE_ENCODER_TEST_BOOL_TRUE_JSON = bool_true.json
    FEATURE_ENCODER_TEST_FLOAT_0_JSON = float_0.json
    FEATURE_ENCODER_TEST_FLOAT_1_JSON = float_1.json
    FEATURE_ENCODER_TEST_FLOAT_M1_JSON = float_m1.json
    FEATURE_ENCODER_TEST_FOO_BAR_JSON = foo_bar.json
    FEATURE_ENCODER_TEST_INT_0_JSON = int_0.json
    FEATURE_ENCODER_TEST_INT64_SMALL_JSON = int64_small.json
    FEATURE_ENCODER_TEST_INT64_BIG_JSON = int64_big.json
    FEATURE_ENCODER_TEST_INT_1_JSON = int_1.json
    FEATURE_ENCODER_TEST_INT_M1_JSON = int_m1.json
    FEATURE_ENCODER_TEST_STRING_JSON = string.json

    ; primitive dicts
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_BIG_FLOAT_JSON = primitive_dict_big_float.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_SMALL_FLOAT_JSON = primitive_dict_small_float.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_BIG_INT_NEGATIVE_JSON = primitive_dict_big_int_negative.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_BIG_INT_POSITIVE_JSON = primitive_dict_big_int_positive.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_BOOL_FALSE_JSON = primitive_dict_bool_false.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_BOOL_TRUE_JSON = primitive_dict_bool_true.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_FLOAT_0_JSON = primitive_dict_float_0.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_FLOAT_1_JSON = primitive_dict_float_1.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_FLOAT_M1_JSON = primitive_dict_float_m1.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_FOO_BAR_JSON = primitive_dict_foo_bar.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_INT_0_JSON = primitive_dict_int_0.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_INT64_SMALL_JSON = primitive_dict_int64_small.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_INT64_BIG_JSON = primitive_dict_int64_big.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_INT_1_JSON = primitive_dict_int_1.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_INT_M1_JSON = primitive_dict_int_m1.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_STRING_JSON = primitive_dict_string.json
    FEATURE_ENCODER_TEST_NESTED_LIST_JSON = nested_list.json
    FEATURE_ENCODER_TEST_NESTED_DICT_STRING_KEYS_JSON = nested_dict_string_keys.json

    ; foo bar dict files
    FEATURE_ENCODER_TEST_DICT_FOO_BAR_JSON = dict_foo_bar.json
    FEATURE_ENCODER_TEST_NOISE_0_WITH_FLOAT_JSON = noise_0_float.json
    FEATURE_ENCODER_TEST_NOISE_0_WITH_INT_JSON = noise_0_int.json
    FEATURE_ENCODER_TEST_NOISE_0_WITH_PRIMITIVE_DICT_FLOAT_JSON = noise_0_dict_float.json
    FEATURE_ENCODER_TEST_NOISE_0_WITH_PRIMITIVE_DICT_INT_JSON = noise_0_dict_int.json
    FEATURE_ENCODER_TEST_NOISE_0_WITH_STRING_JSON = noise_0_string.json
    FEATURE_ENCODER_TEST_NOISE_1_WITH_STRING_JSON = noise_1_string.json
    FEATURE_ENCODER_TEST_SPECIAL_CHARACTERS_STRING_JSON = special_characters_string.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_SPECIAL_CHARACTERS_STRING_JSON = primitive_dict_special_characters_string.json
    FEATURE_ENCODER_TEST_SPECIAL_CHARACTERS_IN_KEY_STRING_JSON = special_characters_in_key_string.json
    FEATURE_ENCODER_TEST_UNICODE_EMOJI_01_JSON = unicode_emoji_01.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_EMOJI_01_JSON = primitive_dict_unicode_emoji_01.json
    FEATURE_ENCODER_TEST_UNICODE_EMOJI_02_JSON = unicode_emoji_02.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_EMOJI_02_JSON = primitive_dict_unicode_emoji_02.json
    FEATURE_ENCODER_TEST_UNICODE_EMOJI_IN_KEY_JSON = unicode_emoji_in_key.json
    FEATURE_ENCODER_TEST_UNICODE_STRING_01_JSON = unicode_string_01.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_STRING_01_JSON = primitive_dict_unicode_string_01.json
    FEATURE_ENCODER_TEST_UNICODE_STRING_02_JSON = unicode_string_02.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_STRING_02_JSON = primitive_dict_unicode_string_02.json
    FEATURE_ENCODER_TEST_UNICODE_STRING_WITH_U0000_JSON = unicode_string_with_u0000.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_STRING_WITH_U0000_JSON = primitive_dict_unicode_string_with_u0000.json
    FEATURE_ENCODER_TEST_UNICODE_U0000_JSON = unicode_u0000.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_UNICODE_U0000_JSON = primitive_dict_unicode_u0000.json
    FEATURE_ENCODER_TEST_ZERO_LENGTH_STRING_JSON = zero_length_string.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_ZERO_LENGTH_STRING_JSON = primitive_dict_zero_length_string.json
    FEATURE_ENCODER_TEST_NEWLINE_TAB_RETURN_SYMBOLS_STRING_JSON = newline_tab_return_symbols_string.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_NEWLINE_TAB_RETURN_SYMBOLS_STRING_JSON = primitive_dict_newline_tab_return_symbols_string.json
    FEATURE_ENCODER_TEST_SEED_BIG_INT32_JSON = seed_int32_big.json
    FEATURE_ENCODER_TEST_NOISE_2_128_JSON = noise_2_128.json
    FEATURE_ENCODER_TEST_NOISE_3_128_JSON = noise_3_128.json
    FEATURE_ENCODER_TEST_NOISE_2_256_JSON = noise_2_256.json
    FEATURE_ENCODER_TEST_NOISE_3_256_JSON = noise_3_256.json
    FEATURE_ENCODER_TEST_ADD_NOISE_JSON = test_add_noise.json
    FEATURE_ENCODER_TEST_ENCODE_FEATURE_VECTOR_JSON = encode_feature_vector.json
    FEATURE_ENCODER_TEST_ENCODE_FEATURE_VECTOR_VARIANT_NAN_JSON = encode_feature_vector_variant_nan.json
    FEATURE_ENCODER_TEST_ENCODE_FEATURE_VECTOR_VARIANT_NAN_GIVENS_NONE_EXTRA_FEATURES_JSON = encode_feature_vector_variant_nan_givens_none_extra_features.json
    FEATURE_ENCODER_TEST_ENCODE_FEATURE_VECTOR_VARIANT_NONE_JSON = encode_feature_vector_variant_none.json
    FEATURE_ENCODER_TEST_ENCODE_FEATURE_VECTOR_VARIANT_NONE_GIVENS_NONE_EXTRA_FEATURES_JSON = encode_feature_vector_variant_none_givens_none_extra_features.json
    FEATURE_ENCODER_ENCODE_FEATURE_VECTOR_INTO_IS_NONE_VALERROR_MSG = `into` can`t be None
    FEATURE_ENCODER_ENCODE_FEATURE_VECTOR_WRONG_TYPE_OF_EXTRA_FEATURES_TYPEERROR_MSG = Provided `extra_features` is not a dict

    ; Since the return for empty inputs is always expected to be {} there is no
    ; need to differentiate between variant and context encoding output
    FEATURE_ENCODER_TEST_NAN_JSON = npnan.json
    FEATURE_ENCODER_TEST_NONE_JSON = none.json
    FEATURE_ENCODER_TEST_EMPTY_LIST_JSON = empty_list.json
    FEATURE_ENCODER_TEST_EMPTY_DICT_JSON = empty_dict.json
    FEATURE_ENCODER_TEST_PRIMITIVE_DICT_NONE_JSON= primitive_dict_null.json
    FEATURE_ENCODER_TEST_SPRINKLED_EQUALS_ZERO_JSON = sprinkled_equals_zero.json
    FEATURE_ENCODER_TEST_LEADING_ZEROS_IN_FEATURE_NAME_01 = leading_zeros_in_feature_names_01.json
    FEATURE_ENCODER_TEST_LEADING_ZEROS_IN_FEATURE_NAME_02 = leading_zeros_in_feature_names_02.json

    ; collisions tests
    FEATURE_ENCODER_TEST_EXTERNAL_COLLISIONS_01_JSON = external_collisions_01.json
    FEATURE_ENCODER_TEST_EXTERNAL_COLLISIONS_02_JSON = external_collisions_02.json
    FEATURE_ENCODER_TEST_INTERNAL_COLLISIONS_01_JSON = internal_collisions_01.json
    FEATURE_ENCODER_TEST_INTERNAL_COLLISIONS_02_JSON = internal_collisions_02.json
    FEATURE_ENCODER_TEST_INTERNAL_COLLISIONS_03_JSON = internal_collisions_03.json

    ; batch encoding tests
    BATCH_ENCODING_SEED = 0
    CHOOSERS_FEATURE_ENCODER_TEST_BATCH_ENCODING_JSONLINES = test_batch_encoding_jsonlies.json
    CHOOSERS_FEATURE_ENCODER_TEST_BATCH_FILLING_MISSING_FEATURES_01 = test_batch_filling_missing_features_01.json
    CHOOSERS_FEATURE_ENCODER_TEST_BATCH_FILLING_MISSING_FEATURES_02 = test_batch_filling_missing_features_02.json

    ; test decision contex
    DECISION_CONTEXT_TEST_CASES_DIR = {toxinidir}/{[tox]pkg_dir}/tests/artifacts/data/test/decision_context
    DECISION_CONTEXT_VALID_VARIANTS_VALID_GIVENS_NO_MODEL_JSON = valid_variants_valid_givens_no_model.json
    DECISION_CONTEXT_VALID_VARIANTS_EMPTY_GIVENS_NO_MODEL_JSON = valid_variants_empty_givens_no_model.json
    DECISION_CONTEXT_VALID_VARIANTS_NONE_GIVENS_NO_MODEL_JSON = valid_variants_none_givens_no_model.json
    DECISION_CONTEXT_VALID_VARIANTS_VALID_GIVENS_JSON = valid_variants_empty_givens.json
    DECISION_CONTEXT_VALID_VARIANTS_EMPTY_GIVENS_JSON = valid_variants_none_givens.json
    DECISION_CONTEXT_VALID_VARIANTS_NONE_GIVENS_JSON = valid_variants_valid_givens.json
    
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_VALID_GIVENS_NO_MODEL_JSON = first_valid_variants_valid_givens_no_model.json
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_EMPTY_GIVENS_NO_MODEL_JSON = first_valid_variants_empty_givens_no_model.json
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_NONE_GIVENS_NO_MODEL_JSON = first_valid_variants_none_givens_no_model.json
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_VALID_GIVENS_JSON = first_valid_variants_empty_givens.json
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_EMPTY_GIVENS_JSON = first_valid_variants_none_givens.json
    DECISION_CONTEXT_TEST_FIRST_VALID_VARIANTS_NONE_GIVENS_JSON = first_valid_variants_valid_givens.json

    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_VALID_GIVENS_NO_MODEL_JSON = random_valid_variants_valid_givens_no_model.json
    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_EMPTY_GIVENS_NO_MODEL_JSON = random_valid_variants_empty_givens_no_model.json
    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_NONE_GIVENS_NO_MODEL_JSON = random_valid_variants_none_givens_no_model.json
    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_VALID_GIVENS_JSON = random_valid_variants_empty_givens.json
    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_EMPTY_GIVENS_JSON = random_valid_variants_none_givens.json
    DECISION_CONTEXT_TEST_RANDOM_VALID_VARIANTS_NONE_GIVENS_JSON = random_valid_variants_valid_givens.json
    
    SDK_HOME_PATH = {toxinidir}

    PYTEST_ADDOPTS=--ignore={[tox]ignored_dir_01}

commands =
    pip3 install --upgrade pip
    pip3 install -r {toxinidir}/improveai/tests/testrequirements.txt
    {envbindir}/pytest
